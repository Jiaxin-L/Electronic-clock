C51 COMPILER V9.55   MAIN                                                                  02/25/2017 21:44:23 PAGE 1   


C51 COMPILER V9.55, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main
                    -.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          #include<reg52.h>
   2          #define uint  unsigned  int
   3          #define uchar unsigned  char
   4          
   5          //定义接口
   6          sbit  beep=P1^7;
   7          sbit  select=P1^0;
   8          sbit  add=P1^1;
   9          sbit  sub=P1^2;
  10          sbit  xuanshi=P1^3;
  11          
  12          //定义变量
  13          bit   flag=1,leap=0;
  14          char  sec_l=0,sec_r=0,min_l=0,min_r=0,hour_l=0,hour_r=0;
  15          char  year_l=0,year_r=0,month_l=0,month_r=0,day_l=0,day_r=0; 
  16          uint  num=0,sec=0,min=0,hour=0;
  17          uint  day=25,month=2,year=17;
  18          char  count=0;
  19          uchar code  table[]={0xc0,0xf9,0xa4,0xb0,0x99,0x92,0x82,0xf8,0x80,0x90};
  20          
  21          
  22          void  display();
  23          void  delayms(uchar x)
  24          {
  25   1        uchar i;
  26   1        while(x--)
  27   1        {
  28   2          for(i=0;i<113;i++);
  29   2        }
  30   1      }
  31          
  32          
  33          void  timer_0() interrupt 1
  34          {
  35   1        TH0=0x4c; 
  36   1        TL0=0x00;
  37   1        num++;
  38   1      
  39   1        if((year%4==0&&year%100!=0)||(year%400==0))
  40   1            leap=1;   
  41   1          else
  42   1            leap=0;    
  43   1        if(num==20)     
  44   1          {
  45   2            num=0;
  46   2            sec++;  
  47   2          }
  48   1        if(sec==60)    
  49   1          {
  50   2            sec=0;
  51   2            min++;
  52   2          }
  53   1        if(min==60)
  54   1          {
C51 COMPILER V9.55   MAIN                                                                  02/25/2017 21:44:23 PAGE 2   

  55   2            min=0;
  56   2            hour++;
  57   2          }
  58   1        if(hour==24)       
  59   1          {
  60   2            hour=0;
  61   2            min=0;
  62   2            sec=0;
  63   2            day++;
  64   2          }
  65   1        if((leap==1&&month==2&&day==30)||(leap==0&&month==2&&day==29))
  66   1          {
  67   2            day=1;
  68   2            month++;
  69   2          }
  70   1        if(month==1||month==3||month==5||month==7||month==8||month==10||month==12)
  71   1          {
  72   2            if(day==32)
  73   2            {
  74   3              day=1;
  75   3              month++;
  76   3            }
  77   2          }
  78   1        if(month==4||month==6||month==9||month==11)
  79   1          {
  80   2            if(day==31)
  81   2            {
  82   3              day=1;
  83   3              month++;
  84   3            }
  85   2          }
  86   1        if(month==13)
  87   1          {
  88   2            year++;
  89   2            month=1;
  90   2          }
  91   1        sec_r=sec%10;
  92   1        sec_l=sec/10;
  93   1        min_r=min%10;
  94   1        min_l=min/10;
  95   1        hour_r=hour%10;
  96   1        hour_l=hour/10;
  97   1      
  98   1        day_r=day%10;
  99   1        day_l=day/10;
 100   1        month_r=month%10;
 101   1        month_l=month/10;
 102   1        year_r=year%10;
 103   1        year_l=year/10;
 104   1      }
 105          
 106          
 107          void  key_flag()  interrupt 0
 108          {
 109   1        flag=!flag;
 110   1      }
 111          void  control(void)
 112          {
 113   1        if(select==0)
 114   1        {
 115   2            EA=0;
 116   2            sec=0;
C51 COMPILER V9.55   MAIN                                                                  02/25/2017 21:44:23 PAGE 3   

 117   2            while(1)
 118   2            {
 119   3              display();
 120   3              if(add==0)
 121   3              {
 122   4                delayms(10);
 123   4                EA=1;
 124   4                if(add==0)
 125   4                {
 126   5                  sec=0;
 127   5                  min++;
 128   5                  display();
 129   5                  while(!add)
 130   5                  {
 131   6                    if(min==60)
 132   6                      min=0;
 133   6                  }
 134   5                }
 135   4              }
 136   3              if(sub==0)
 137   3              {
 138   4                delayms(10);
 139   4                EA=1;
 140   4                if(sub==0)
 141   4                {
 142   5                  sec=0;
 143   5                  min--;
 144   5                  display();
 145   5                  while(!sub)
 146   5                  {
 147   6                    if(min==-1)
 148   6                      min=59;
 149   6                  }
 150   5                }
 151   4              } 
 152   3            } 
 153   2          } 
 154   1            if(xuanshi==0)
 155   1            {
 156   2              EA=0;
 157   2              sec=0;
 158   2              while(1)
 159   2              {
 160   3                display();
 161   3                if(add==0)
 162   3                {
 163   4                  delayms(10);
 164   4                  EA=1;
 165   4                  if(add==0)
 166   4                  {
 167   5                    sec=0;
 168   5                    hour++;
 169   5                    display();
 170   5                    while(!add)
 171   5                    {
 172   6                      if(hour==24)
 173   6                        hour=0;
 174   6                    }
 175   5                  }
 176   4                  }
 177   3                if(sub==0)
 178   3                {
C51 COMPILER V9.55   MAIN                                                                  02/25/2017 21:44:23 PAGE 4   

 179   4                  delayms(10);
 180   4                  EA=1;
 181   4                  if(sub==0)
 182   4                  {
 183   5                    sec=0;
 184   5                    hour--;
 185   5                    while(!sub)
 186   5                    {
 187   6                      if(hour==-1)
 188   6                        hour=23;
 189   6                    }
 190   5                    display();
 191   5                  }
 192   4          
 193   4                }
 194   3              } 
 195   2      
 196   2              } 
 197   1       }
 198          void  baoshi() 
 199          {
 200   1        if(min==0&&sec<10)
 201   1        {
 202   2          beep=0;
 203   2          delayms(10);
 204   2          beep=1;
 205   2        }
 206   1        else
 207   1          beep=1;
 208   1      }
 209          
 210          void  alarm_clock()
 211          {
 212   1        if(hour==0&&min==2&&sec<15) 
 213   1        {
 214   2          beep=0;
 215   2          delayms(10);
 216   2          beep=1;
 217   2        }
 218   1        else
 219   1          beep=1;
 220   1      }
 221          
 222          
 223          void display()
 224          {
 225   1        if(flag==1) 
 226   1        {
 227   2          P2=0x80;
 228   2          P0=table[sec_r];
 229   2          delayms(5);
 230   2          P2=0;
 231   2        
 232   2            P2=0x40;
 233   2          P0=table[sec_l];
 234   2          delayms(5);
 235   2          P2=0;
 236   2        
 237   2            P2=0x20;
 238   2          P0=0xbf;
 239   2          delayms(5);
 240   2          P2=0;
C51 COMPILER V9.55   MAIN                                                                  02/25/2017 21:44:23 PAGE 5   

 241   2        
 242   2            P2=0x10;
 243   2          P0=table[min_r];
 244   2          delayms(5);
 245   2          P2=0;
 246   2        
 247   2            P2=0x08;
 248   2          P0=table[min_l];
 249   2          delayms(5);
 250   2          P2=0;
 251   2        
 252   2            P2=0x04;
 253   2          P0=0xbf;
 254   2          delayms(5);
 255   2          P2=0;
 256   2        
 257   2          P2=0x02;
 258   2          P0=table[hour_r];
 259   2          delayms(5);
 260   2          P2=0;
 261   2        
 262   2            P2=0x01;
 263   2          P0=table[hour_l];
 264   2          delayms(5);
 265   2          P2=0;
 266   2        }
 267   1        else
 268   1          {   
 269   2          P2=0x80;
 270   2          P0=table[day_r];
 271   2          delayms(5);
 272   2          P2=0;
 273   2        
 274   2            P2=0x40;
 275   2          P0=table[day_l];
 276   2          delayms(5);
 277   2          P2=0;
 278   2        
 279   2            P2=0x20;
 280   2          P0=0xbf;
 281   2          delayms(5);
 282   2          P2=0;
 283   2        
 284   2            P2=0x10;
 285   2          P0=table[month_r];
 286   2          delayms(5);
 287   2          P2=0;
 288   2        
 289   2            P2=0x08;
 290   2          P0=table[month_l];
 291   2          delayms(5);
 292   2          P2=0;
 293   2        
 294   2            P2=0x04;
 295   2          P0=0xbf;
 296   2          delayms(5);
 297   2          P2=0;
 298   2        
 299   2          P2=0x02;
 300   2          P0=table[year_r];
 301   2          delayms(5);
 302   2          P2=0;
C51 COMPILER V9.55   MAIN                                                                  02/25/2017 21:44:23 PAGE 6   

 303   2        
 304   2            P2=0x01;
 305   2          P0=table[year_l];
 306   2          delayms(5);
 307   2          P2=0; 
 308   2          } 
 309   1      }
 310          
 311          void timer0(void)
 312          {
 313   1          TMOD = 0x01;
 314   1          TH0 = 0x4C;
 315   1          TL0 = 0x00;
 316   1          EA = 1;
 317   1          ET0 = 1;
 318   1          TR0 = 1;
 319   1        PT0=0;
 320   1      }
 321          
 322          
 323          void Int0()
 324          { 
 325   1          EA=1;
 326   1        EX0=1;
 327   1        IT0=1;
 328   1        PX0=0;
 329   1      }
 330          void  main()
 331          {
 332   1        timer0();
 333   1        Int0();
 334   1        while(1)
 335   1        {
 336   2          display();
 337   2          control();
 338   2          baoshi();
 339   2          alarm_clock();
 340   2        }
 341   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1106    ----
   CONSTANT SIZE    =     10    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     27    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      2    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
